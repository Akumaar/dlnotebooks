{"paragraphs":[{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1525694407364_2081864768","id":"20180507-120007_513262958","dateCreated":"2018-05-07T12:00:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:735","text":"%md\nThis notebook builds a Spark MLlib pipeline: PCA (Spark MLlib) + K-Means (SageMaker).","dateUpdated":"2018-05-07T12:22:41+0000","dateFinished":"2018-05-07T12:22:41+0000","dateStarted":"2018-05-07T12:22:41+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>This notebook builds a Spark MLlib pipeline: PCA (Spark MLlib) + K-Means (SageMaker).</p>\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1525694396533_-884411334","id":"20180507-115956_1180516757","dateCreated":"2018-05-07T11:59:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:679","text":"import org.apache.spark.ml.Pipeline\nimport org.apache.spark.ml.feature.PCA\nimport org.apache.spark.sql.SparkSession\nimport com.amazonaws.services.sagemaker.{AmazonSageMaker, AmazonSageMakerClientBuilder}\nimport com.amazonaws.services.sagemaker.sparksdk.{IAMRole, SageMakerResourceCleanup}\nimport com.amazonaws.services.sagemaker.sparksdk.algorithms.KMeansSageMakerEstimator\nimport com.amazonaws.services.sagemaker.sparksdk.transformation.serializers.ProtobufRequestRowSerializer","dateUpdated":"2018-05-07T12:19:49+0000","dateFinished":"2018-05-07T12:19:50+0000","dateStarted":"2018-05-07T12:19:49+0000","title":"Import Spark classes","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.ml.Pipeline\nimport org.apache.spark.ml.feature.PCA\nimport org.apache.spark.sql.SparkSession\nimport com.amazonaws.services.sagemaker.{AmazonSageMaker, AmazonSageMakerClientBuilder}\nimport com.amazonaws.services.sagemaker.sparksdk.{IAMRole, SageMakerResourceCleanup}\nimport com.amazonaws.services.sagemaker.sparksdk.algorithms.KMeansSageMakerEstimator\nimport com.amazonaws.services.sagemaker.sparksdk.transformation.serializers.ProtobufRequestRowSerializer\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1525694396135_2075477279","id":"20180507-115956_958325583","dateCreated":"2018-05-07T11:59:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:623","text":"val spark = SparkSession.builder.getOrCreate\nval region = \"us-east-1\"\nval roleArn = \"arn:aws:iam::ACCOUNT_NUMBER:role/ROLE_NAME\"","dateUpdated":"2018-05-07T12:19:53+0000","dateFinished":"2018-05-07T12:19:54+0000","dateStarted":"2018-05-07T12:19:53+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"spark: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@2d4cf021\nregion: String = us-east-1\nroleArn: String = arn:aws:iam::ACCOUNT_NUMBER:role/ROLE_NAME\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1525694396024_2030461657","id":"20180507-115956_1099735787","dateCreated":"2018-05-07T11:59:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:567","text":"val trainingData = spark.read.format(\"libsvm\").option(\"numFeatures\", \"784\").load(s\"s3://sagemaker-sample-data-$region/spark/mnist/train/\")\nval testData = spark.read.format(\"libsvm\").option(\"numFeatures\", \"784\").load(s\"s3://sagemaker-sample-data-$region/spark/mnist/test/\")","dateUpdated":"2018-05-07T12:19:57+0000","dateFinished":"2018-05-07T12:19:57+0000","dateStarted":"2018-05-07T12:19:57+0000","title":"Load MNIST data set","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"trainingData: org.apache.spark.sql.DataFrame = [label: double, features: vector]\ntestData: org.apache.spark.sql.DataFrame = [label: double, features: vector]\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1525694395814_-1898994184","id":"20180507-115955_182134995","dateCreated":"2018-05-07T11:59:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:511","text":"val pcaEstimator = new PCA().setInputCol(\"features\").setOutputCol(\"projectedFeatures\").setK(50)","dateUpdated":"2018-05-07T12:20:02+0000","dateFinished":"2018-05-07T12:20:03+0000","dateStarted":"2018-05-07T12:20:02+0000","title":"Configure PCA stage","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"pcaEstimator: org.apache.spark.ml.feature.PCA = pca_29da718fdcbf\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1525694395680_-1947472545","id":"20180507-115955_1154931746","dateCreated":"2018-05-07T11:59:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:455","text":"val kMeansSageMakerEstimator = new KMeansSageMakerEstimator(\n    sagemakerRole = IAMRole(roleArn), \n    requestRowSerializer = new ProtobufRequestRowSerializer(featuresColumnName = \"projectedFeatures\"),\n    trainingSparkDataFormatOptions = Map(\"featuresColumnName\" -> \"projectedFeatures\"), \n    trainingInstanceType = \"ml.p2.xlarge\", trainingInstanceCount = 1, \n    endpointInstanceType = \"ml.c4.xlarge\", endpointInitialInstanceCount = 1)\n    \nkMeansSageMakerEstimator.setK(10).setFeatureDim(50)","dateUpdated":"2018-05-07T12:20:05+0000","dateFinished":"2018-05-07T12:20:05+0000","dateStarted":"2018-05-07T12:20:05+0000","title":"Configure K-Means stage","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"kMeansSageMakerEstimator: com.amazonaws.services.sagemaker.sparksdk.algorithms.KMeansSageMakerEstimator = sagemaker_3e11a874b5a3\nres609: kMeansSageMakerEstimator.type = sagemaker_3e11a874b5a3\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1525694552602_164861858","id":"20180507-120232_779650267","dateCreated":"2018-05-07T12:02:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:791","text":"val pipeline = new Pipeline().setStages(Array(pcaEstimator, kMeansSageMakerEstimator))\nval pipelineModel = pipeline.fit(trainingData)","dateUpdated":"2018-05-07T12:20:10+0000","dateFinished":"2018-05-07T12:29:20+0000","dateStarted":"2018-05-07T12:20:10+0000","title":"Build and run pipeline","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"pipeline: org.apache.spark.ml.Pipeline = pipeline_db353e6dfec7\npipelineModel: org.apache.spark.ml.PipelineModel = pipeline_db353e6dfec7\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1525694387752_905825298","id":"20180507-115947_933969840","dateCreated":"2018-05-07T11:59:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:391","text":"val transformedData = pipelineModel.transform(testData)\ntransformedData.show()","dateUpdated":"2018-05-07T12:21:08+0000","dateFinished":"2018-05-07T12:29:21+0000","dateStarted":"2018-05-07T12:21:08+0000","title":"Predict test data set","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"transformedData: org.apache.spark.sql.DataFrame = [label: double, features: vector ... 3 more fields]\n+-----+--------------------+--------------------+-------------------+---------------+\n|label|            features|   projectedFeatures|distance_to_cluster|closest_cluster|\n+-----+--------------------+--------------------+-------------------+---------------+\n|  7.0|(784,[202,203,204...|[424.527675108320...| 1362.5216064453125|            6.0|\n|  2.0|(784,[94,95,96,97...|[777.495806467953...|    1816.6611328125|            4.0|\n|  1.0|(784,[128,129,130...|[-189.22802355912...|    959.30419921875|            8.0|\n|  0.0|(784,[124,125,126...|[1990.70583089721...|    1514.2744140625|            5.0|\n|  4.0|(784,[150,151,159...|[946.077017433917...|  1189.254150390625|            7.0|\n|  1.0|(784,[156,157,158...|[-264.46945985278...|  937.1316528320312|            1.0|\n|  4.0|(784,[149,150,151...|[502.087335041736...| 1438.8399658203125|            3.0|\n|  9.0|(784,[179,180,181...|[438.703086461166...|   1429.40771484375|            7.0|\n|  5.0|(784,[129,130,131...|[1019.13380549721...|     1821.751953125|            9.0|\n|  9.0|(784,[209,210,211...|[725.804171346720...|  1265.525146484375|            6.0|\n|  0.0|(784,[123,124,125...|[1882.34258754238...| 1372.8426513671875|            5.0|\n|  6.0|(784,[94,95,96,97...|[1091.09610327598...|   1572.19384765625|            9.0|\n|  9.0|(784,[208,209,210...|[587.861814723698...|   950.849853515625|            3.0|\n|  0.0|(784,[152,153,154...|[1806.12591709845...|  1463.397216796875|            5.0|\n|  1.0|(784,[125,126,127...|[-121.37713905835...|    668.33251953125|            8.0|\n|  5.0|(784,[124,125,126...|[867.896344990284...|   1505.22021484375|            2.0|\n|  9.0|(784,[179,180,181...|[929.963113523383...| 1228.4801025390625|            7.0|\n|  7.0|(784,[200,201,202...|[740.036902004868...| 1576.8519287109375|            3.0|\n|  3.0|(784,[118,119,120...|[835.686403402641...| 1922.3026123046875|            2.0|\n|  4.0|(784,[158,159,185...|[514.838416853081...|  1113.300537109375|            3.0|\n+-----+--------------------+--------------------+-------------------+---------------+\nonly showing top 20 rows\n\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1525695521834_-2137309760","id":"20180507-121841_22786542","dateCreated":"2018-05-07T12:18:41+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:912"}],"name":"Clustering MNIST with a Pipeline: PCA + K-Means (Scala)","id":"2DC8MU1B9","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}
